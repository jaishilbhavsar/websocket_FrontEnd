<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
        integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Shopin Responsive web template, Bootstrap Web Templates, Flat Web Templates, AndroId Compatible web template, 
    Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
    <!--theme-style-->
    <script>
        var socket;

        function connectServer() {
            console.log("connecting");
            var url="ws://localhost:1337";
            // var params="?auth=zda";
            url+="/"+localStorage.getItem('Token');
            socket = new WebSocket(url);
            socket.onopen= ()=>{
                console.log("WebSocket Connection Established");
            };
            socket.onclose = ()=>{
                console.log(" Websocket Connection Closed ");
            }
            socket.onmessage = function (event) {
                console.log(event.data);
                let stringMessage=String(event.data);
                let splittedString=stringMessage.split(" ");
                if(splittedString[0]==="ID"){
                    socket.send(`Verification ${splittedString[1]}`);
                    console.log(`Verification ${splittedString[1]}`);
                }
                // socket.send(`Verification ${splittedString[3]} Basic ${localStorage.getItem('Token')}`);
                // socket.send(`Verification ${localStorage.getItem('Token')}`);
                var data = "";
                var str = event.data;
                var res = str.split("</Trader>");
                var temp = res[0].split(">");
                if (temp[1] == "BROKER") {
                    res = res[1];
                    var product = res.split("</Product>");
                    temp = product[0].split(">");
                    data = temp[1];
                    res = product[1];
                    var message = res.split("</Message>");
                    temp = message[0];
                    var msg = temp.split("<Message>");
                    msg = msg[1];
                    var tags = msg.split("*");
                    tags.forEach(tag => {
                        var arr = tag.split("|");
                        var cntr = 1;
                        var flag = 0;
                        console.log(arr.length);
                        var myHtmlContent = "";
                        var pitId = arr[0];
                        var flag = true;
                        arr.forEach(ele => {
                            console.log(ele);
                            if (ele != "E" && ele != "Z") {
                                myHtmlContent += "<td>" + ele + "</td>";
                            } else if (ele == null || ele == " ") {
                                myHtmlContent += "<td> </td>";
                            } else if (ele == "B" || ele == "S") {
                                console.log("inside "+ele);
                                if (flag) {
                                    myHtmlContent += "<td>" + ele + "</td>";
                                    flag = !flag;
                                } else {
                                    var tableRef = document.getElementById('myTable')
                                        .getElementsByTagName('tbody')[
                                            0];
                                    var newRow = tableRef.insertRow(tableRef.rows.length);
                                    newRow.innerHTML = myHtmlContent;
                                    myHtmlContent += "<td>" + pitId + "</td>";
                                    myHtmlContent += "<td>" + ele + "</td>";
                                    flag = !flag;
                                }
                            }

                        });
                        var tableRef = document.getElementById('myTable').getElementsByTagName('tbody')[
                            0];
                        var newRow = tableRef.insertRow(tableRef.rows.length);
                        newRow.innerHTML = myHtmlContent;


                    });
                }
            }
            console.log("connected");
            //window.location.pathname="C:/Projects/FIX/login.html"; 
        }

        function sendData() {
            console.log("sending");
            socket.send("Hey Sending you msg ---");
            console.log("sent");
        }
    </script>
</head>

<body>
    <button onclick="connectServer()">Connect</button>
    <button onclick="sendData()">Send</button>
    <table class="table table-striped table-dark" id="myTable">
        <thead>
            <tr>
                <th scope="col">Pit Id</th>
                <th scope="col">Buy/Sell</th>
                <th scope="col">Price</th>
                <th scope="col">Qty</th>
                <th scope="col">Order Id</th>
                <th scope="col">Trader Code</th>
                <th scope="col">Client Id</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</body>